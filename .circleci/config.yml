version: 2

jobs:
  test:
    working_directory: ~/webreview
    docker:
    - image: ubuntu:xenial
    steps:
    - checkout

    - run:
        name: Update Pip
        command: |
          apt-get update
          apt-get install -y --no-install-recommends python python-pip

    - run:
        name: Install pipenv
        command: pip install pipenv

    - run:
        name: Update pipenv
        command: pipenv update

    - run:
        name: Install Packages
        command: pipenv install --dev

    - run:
        name: Client Secret
        command: |
          echo $CLIENT_SECRET | base64 --decode > ~/client-secret.json

    - run:
        name: Run Tests
        command: |
          pipenv run nosetests \
            -v \
            --rednose \
            --with-coverage \
            --cover-erase \
            --cover-xml \
            --cover-package=webreview \
            webreview
        environment:
          AUTH_KEY_FILE: ~/client-secret.json

workflows:
  version: 2
  test:
    jobs:
    - test
